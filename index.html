<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>宇宙人発見伝</title>
    <style>
        body {
            background-color: #00b4d4;
            margin: 0;
            padding: 0;
            color: white;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }

        h1 {
            text-align: center;
        }

        #completedStamps,
        #lastUpdateTime {
            text-align: center;
            font-size: 18px;
        }

        #gameStartPopup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .popup-content {
            position: relative;
            max-width: 100%;
            height: 100%;
            background: url('Top-Img.png') center center / cover no-repeat;
            text-align: center;
        }

        .overlay-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 20px;
            color: #5f5f5f;
            font-size: 1rem;
        }

        .Btytle {
            width: 80%;
        }

        .overlay-content button {
            background-color: #12335f;
            color: white;
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        .overlay-content button:hover {
            background-color: #fff;
        }

        .Stytle {
            width: 20%;
            padding: 10px;
            position: absolute;
            top: 0;
            left: 0;
        }

        .alien {
            width: 50%;
            padding: 20px;
            text-align: center;
            margin: 0 auto;
            display: block;
        }

        #hintButtons {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }

        #hintButtons a {
            background-color: #12335f;
            color: white;
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
        }

        #hintButtons a:hover {
            background-color: #fff;
            color: #12335f;
        }
    </style>
</head>

<body>
    <h1><img class="Stytle" src="invader-hunt@2x.png" alt="画像の説明"></h1>
    <div id="completedStamps"></div>
    <div id="lastUpdateTime"></div>

    <div id="gameStartPopup" style="display: block;">
        <div class="popup-content">
            <div class="overlay-content">
                <img class="Btytle" src="invader-hunt@2x.png" alt="画像の説明">
                <p>ゲームを始めますか？</p>
                <button onclick="startGame()">OK</button>
            </div>
        </div>
    </div>

    <img class="alien" src="alien2.png" alt="画像の説明">

    <div id="hintButtons">
        <a id="hint1Button" href="https://x.com/utyuzin2023/status/1735751507759468580?s=20" target="_blank">ヒント1</a>
        <a id="hint2Button" href="https://x.com/utyuzin2023/status/1735751932134953319?s=20" target="_blank">ヒント2</a>
        <a id="hint3Button" href="https://x.com/utyuzin2023/status/1735752028020937006?s=20" target="_blank">ヒント3</a>
    </div>

    <div id="hintContent"></div>

    <script>
        /* 既存のスクリプトのコード */

        function updateUserLocation() {
            if (navigator.geolocation && gameStarted) {
                locationUpdateInterval = setInterval(() => {
                    navigator.geolocation.getCurrentPosition(
                        position => {
                            const userLocation = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude,
                            };

                            const currentTime = new Date().getTime();
                            if (currentTime - lastDialogTime >= dialogInterval) {
                                if (isInsideArea(userLocation)) {
                                    if (hasClue1 && hasClue2 && hasClue3) {
                                        document.getElementById('completedStamps').innerHTML = '<h2>すべてのスタンプを集めました！</h2>';
                                        document.getElementById('hintButtons').style.display = 'none'; // オプション: スタンプ完了後にヒントボタンを非表示にする
                                        clearInterval(locationUpdateInterval); // オプション: スタンプ完了後に位置情報の更新を停止する
                                    } else {
                                        document.getElementById('completedStamps').innerHTML = '<p>探索中です</p>';
                                    }

                                    let stamped = false;
                                    let hasClue123 = hasClue1 && hasClue2 && hasClue3;
                                    stampLocations.forEach(location => {
                                        const distance = calculateDistance(userLocation, location);
                                        const locationKey = `${location.lat.toFixed(4)}-${location.lng.toFixed(4)}`;

                                        if (distance < 50 && !stamped && (hasClue123 || locationKey === '35.6068-139.3319')) {
                                            alert('Stamped!');
                                            stamped = true;
                                            stampedHistory.push(locationKey);

                                            if (locationKey === '35.6152-139.3349') {
                                                hasClue1 = true;
                                            } else if (locationKey === '35.6157-139.3333') {
                                                hasClue2 = true;
                                            } else if (locationKey === '35.6167-139.3334') {
                                                hasClue3 = true;
                                            }

                                            const stampedInfo = `Location: Lat ${location.lat}, Lng ${location.lng}`;
                                            document.getElementById('completedStamps').innerHTML += `<p>${stampedInfo}</p>`;
                                            displayClueInfo(location);
                                            lastDialogTime = currentTime;
                                            updateHintButtonStatus();
                                        }
                                    });
                                } else {
                                    document.getElementById('completedStamps').innerHTML = '<p>探索範囲外です</p>';
                                }
                            }

                            lastUpdateTime = new Date().getTime();
                            updateLastUpdateTime();
                        },
                        error => {
                            console.error('ユーザーの位置情報を取得できませんでした:', error);
                        }
                    );
                }, 5000);
            } else {
                console.error('このブラウザはジオロケーションをサポートしていないか、ゲームがまだ開始されていません。');
            }
        }
    </script>
</body>

</html>
